#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Mon Sep  6 21:26:45 2021

@author: Claire He
Transcripts scrapping that works also on MacOS and Linux distributions. 
"""

import  requests
from PyPDF2 import PdfFileReader
from PyPDF2 import PdfFileWriter 
from update_scrapping import get_date_list
import os
from tqdm import trange
dir_name = os.path.dirname(__file__)
project_directory = dir_name



l_month = ['January','February','March','April','May','June','July','August','September','October','November','December']

l_dates = list()

date_to_append = get_date_list(["2012","2013","2014","2015"])
#[20120125, 20120312, 20120425, 20120620, 20120801, 20120913, 20121024, 20121212,
#20130130, 20130320, 20130501, 20130619, 20130918, 20131016, 20131030, 20131218,
#20140129, 20140304, 20140319, 20140430, 20140618, 20140630, 20140917, 20141029, 20141217]

#%%

for date in date_to_append:
    l_dates.append(date)
#Scrappage des donn√©es par date
for date in l_dates:
	
    url = 'https://www.federalreserve.gov/monetarypolicy/files/FOMC'+str(date)+'meeting.pdf'

    r = requests.get(url)
    with open(project_directory+'/transcript_files_pdf/'+str(date)+'meeting.pdf', "wb") as code:
        code.write(r.content)
        
    pdf_file = open(project_directory+'/transcript_files_pdf/'+str(date)+'meeting.pdf', 'rb')
    
    pdfReader = PyPDF2.PdfFileReader(pdf_file)
    count = pdfReader.numPages
    output = []
    for i in trange(count):
        page = pdfReader.getPage(i)
        output += page.extractText()
    
    txtfile = open(project_directory+'/transcript_files_txt/'+str(date)+"meeting.txt","a")
    txtfile.writelines(output)
    

    







